#!/bin/execlineb -P

backtick -D "/defaults" DEFAULT_EXEC_DIR {
	printcontenv DEFAULT_EXEC_DIR
}
importas -isu DEFAULT_EXEC_DIR DEFAULT_EXEC_DIR
elglob -s0 g "${DEFAULT_EXEC_DIR}/*"
forx -o 0 -p -E path { ${g} }
if -t { s6-test -f ${path} }
if -t {
	ifelse {
		pipeline { grep -n "#!" ${path} }
		grep -q "1:#!"
	} { chmod a+x ${path} }
	s6-test -x ${path}
}
fdmove -c 1 2
foreground { s6-echo -n "[INFO] symlink: " }
ln -fsv ${path} "/usr/local/bin"
